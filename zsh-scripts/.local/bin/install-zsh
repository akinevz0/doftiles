#!/bin/bash

# Define installation directories
ZSH=${HOME}/.config/oh-my-zsh/
ZSH_INSTALL_DIR=zsh/.cache/
ZSH_CUSTOM=$ZSH/custom
ZSH_PLUGINS_DIR=$ZSH_CUSTOM/plugins

# Function to handle errors
handle_error() {
    echo "Error: $1" >&2
    echo "Ensure you're in the doftiles directory and try again."
    exit 1
}

# Define plugins
plugins=(
    "zsh-completions"
    "zsh-autosuggestions"
    "zsh-syntax-highlighting"
)

# Function to install a plugin
install_plugin() {
    plugin_name=$1
    plugin_dir=$ZSH_INSTALL_DIR/$plugin_name
    plugin_dest=$ZSH_PLUGINS_DIR/$plugin_name
    ln -s "$plugin_dir" "$plugin_dest" || handle_error "Failed to install plugin: $plugin_name"
}

# Run Oh My Zsh install script
echo "Installing Oh My Zsh..."
ln -st $ZSH_INSTALL_DIR/oh-my-zsh/ $ZSH || handle_error "Failed to install Oh My Zsh"

echo "Fixing up permissions."
fix-permissions $ZSH || handle_error "Failed to fix permissions"

echo "Installing plugins..."
for plugin in "${plugins[@]}"; do
    install_plugin "$plugin" || handle_error "Failed to install plugin: $plugin"
done

echo "Zsh installation completed successfully!"
