#!/bin/bash

# Define the directories
BASE=zsh-scripts
INSTALL_DIR=${BASE}/.local/share
ZSH_DIR=$INSTALL_DIR/oh-my-zsh
ZSH_CUSTOM=$ZSH_DIR/custom
ZSH_PLUGINS_DIR=$ZSH_CUSTOM/plugins

# Function to handle errors
handle_error() {
    echo "Error: $1" >&2
    echo "Ensure you're in the doftiles directory and try again."
    exit 1
}

zsh_ext=(
    "https://github.com/romkatv/powerlevel10k"
    "https://github.com/ohmyzsh/oh-my-zsh"
)

# Define plugins
plugins=(
    "https://github.com/zsh-users/zsh-completions"
    "https://github.com/zsh-users/zsh-autosuggestions"
    "https://github.com/zsh-users/zsh-syntax-highlighting"
)

# Function to install a plugin
install_plugin() {
    plugin_name=$1
    plugin_dir=$INSTALL_DIR/$plugin_name
    plugin_dest=$ZSH_PLUGINS_DIR/${plugin_name##*/}
    git submodule add "$plugin_dir" "$plugin_dest" || handle_error "Failed to install plugin: $plugin_name"
}

install_ext() {
    ext_name=$1
    ext_dir=$INSTALL_DIR/${ext_name##*/}
    git submodule add $ext_name $ext_dir || handle_error "Failed to install extension: $ext_name"
}

# Install oh-my-zsh and p10k
echo "Installing oh-my-zsh and p10k"
for ext in "${zsh_ext[@]}"; do
    install_ext $ext || handle_error "Failed to install extension: $ext"
done

echo "Installing plugins..."
for plugin in "${plugins[@]}"; do
    install_plugin "$plugin" || handle_error "Failed to install plugin: $plugin"
done